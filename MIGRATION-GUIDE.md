# Migration Guide: Sidelined Routing System

This guide helps you migrate from the original hardcoded sidebar implementations to the new unified routing system based on `todo_routing_solution_20250812.md`.

## Overview of Changes

The new routing system provides:
- **Universal routing support**: React Router, Next.js, custom handlers, and href fallback
- **Environment detection**: Automatic strategy detection for dev/prod environments  
- **Base URL handling**: Support for subdirectories and different deployment contexts
- **Type safety**: Full TypeScript support with comprehensive interfaces
- **Backwards compatibility**: Gradual migration path from existing implementations

## Migration Paths

### 1. From Modelosaurus Sidebar

**Before (Original):**
```typescript
import Sidebar from './sidebars/Modelosaurus';

const sidebarItems = [
  { id: 1, name: 'Dashboard', icon: dashboard, url: '/dashboard' },
  { id: 2, name: 'Fine Tuning', icon: build, url: '/finetune' },
  // ...
];

<Sidebar>{children}</Sidebar>
```

**After (New Routing System):**
```typescript
import Sidebar from './sidebars/ModelosaurusRefactored';
import { modelosaurusConfig } from './presets/sidebar-presets';
import dashboard from './assets/images/sidebar-icons/dashboard.png';
import build from './assets/images/sidebar-icons/build.png';

// Option 1: Use preset with custom items
const customConfig = {
  ...modelosaurusConfig,
  navigation: {
    ...modelosaurusConfig.navigation,
    strategy: 'react-router', // or 'next', 'custom', 'href'
    baseUrl: process.env.NODE_ENV === 'production' ? '/myapp' : '',
    items: [
      {
        id: 'dashboard',
        name: 'Dashboard',
        path: '/dashboard',
        icon: <img src={dashboard} className=\"w-full h-full mask mask-circle\" alt=\"Dashboard\" />,
        section: 'main',
      },
      {
        id: 'finetune',
        name: 'Fine Tuning',
        path: '/finetune',
        icon: <img src={build} className=\"w-full h-full mask mask-circle\" alt=\"Fine Tuning\" />,
        section: 'main',
      },
      // ...
    ],
  },
};\n\n<Sidebar config={customConfig}>{children}</Sidebar>\n```\n\n**Option 2: Minimal Migration (Auto-detection)**\n```typescript\nimport Sidebar from './sidebars/ModelosaurusRefactored';\n\n// Auto-detects routing strategy and uses default configuration\n<Sidebar>{children}</Sidebar>\n```\n\n### 2. From Corporate Sidebar\n\n**Before (Original):**\n```typescript\nimport Sidebar from './sidebars/Corporate';\n\n<Sidebar role=\"admin\">\n  <YourPageContent />\n</Sidebar>\n```\n\n**After (New Routing System):**\n```typescript\nimport Sidebar from './sidebars/CorporateRefactored';\nimport { corporateConfig } from './presets/sidebar-presets';\n\nconst customConfig = {\n  ...corporateConfig,\n  navigation: {\n    ...corporateConfig.navigation,\n    strategy: 'react-router', // Auto-detected if omitted\n    baseUrl: '/admin', // Optional base URL\n  },\n  user: {\n    currentRole: 'admin',\n    showLogout: true,\n    onLogout: async () => {\n      await handleLogout();\n      window.location.href = '/';\n    },\n  },\n};\n\n<Sidebar config={customConfig} role=\"admin\">\n  <YourPageContent />\n</Sidebar>\n```\n\n### 3. From Sakura Sidebar\n\n**Before (Original):**\n```typescript\nimport Sidebar from './sidebars/Sakura';\nimport { SidebarItem } from './SidebarItem';\n\nconst sidebarItems = [\n  { icon: <ChartBarIcon />, text: \"Dashboard\", url: \"/dashboard\" },\n  // ...\n];\n\n<Sidebar>{children}</Sidebar>\n```\n\n**After (New Routing System):**\n```typescript\nimport Sidebar from './sidebars/SakuraRefactored';\nimport { sakuraConfig } from './presets/sidebar-presets';\nimport { ChartBarIcon } from '@heroicons/react/24/outline';\n\nconst customConfig = {\n  ...sakuraConfig,\n  navigation: {\n    ...sakuraConfig.navigation,\n    items: [\n      {\n        id: 'dashboard',\n        name: 'Dashboard',\n        path: '/dashboard',\n        icon: <ChartBarIcon />,\n        section: 'main',\n      },\n      // ...\n    ],\n  },\n};\n\n<Sidebar config={customConfig}>{children}</Sidebar>\n```\n\n### 4. From ERP Sidebar\n\n**Before (Original):**\n```typescript\nimport Sidebar from './sidebars/ERP';\n\n<Sidebar>{children}</Sidebar>\n```\n\n**After (New Routing System):**\n```typescript\nimport Sidebar from './sidebars/ERPRefactored';\nimport { erpConfig } from './presets/sidebar-presets';\n\nconst customConfig = {\n  ...erpConfig,\n  user: {\n    currentRole: 'admin', // or 'receptionist', 'tenant'\n  },\n};\n\n<Sidebar config={customConfig}>{children}</Sidebar>\n```\n\n## Routing Strategy Migration\n\n### Automatic Detection (Recommended)\n\nThe system automatically detects your routing environment:\n\n```typescript\nconst config = {\n  navigation: {\n    autoDetect: true, // Enables automatic detection\n    items: [...],\n  },\n};\n```\n\n### Manual Strategy Configuration\n\n#### React Router Apps\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'react-router',\n    items: [{ id: '1', name: 'Dashboard', path: '/dashboard' }]\n  }\n};\n```\n\n#### Next.js Apps\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'next',\n    items: [{ id: '1', name: 'Dashboard', path: '/dashboard' }]\n  }\n};\n```\n\n#### Apps in Subdirectories\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'href',\n    baseUrl: process.env.NODE_ENV === 'production' ? '/myapp' : '',\n    items: [{ id: '1', name: 'Home', path: '/home' }]\n  }\n};\n```\n\n#### Custom Navigation\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'custom',\n    onNavigate: (item) => {\n      // Custom navigation logic\n      console.log(`Navigating to ${item.path}`);\n      myCustomRouter.push(item.path);\n    },\n    items: [...],\n  }\n};\n```\n\n## Environment-Specific Configurations\n\n### Development vs Production\n\n**Environment Variables (.env)**\n```bash\n# Development\nREACT_APP_BASE_URL=\n\n# Production  \nREACT_APP_BASE_URL=/myapp\n```\n\n**Configuration**\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'react-router',\n    baseUrl: process.env.REACT_APP_BASE_URL || '',\n    items: [...],\n  },\n};\n```\n\n### Next.js Specific\n\n**next.config.js**\n```javascript\nmodule.exports = {\n  basePath: process.env.NODE_ENV === 'production' ? '/myapp' : '',\n  env: {\n    NEXT_PUBLIC_BASE_PATH: process.env.NODE_ENV === 'production' ? '/myapp' : '',\n  },\n};\n```\n\n**Configuration**\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'next',\n    baseUrl: process.env.NEXT_PUBLIC_BASE_PATH,\n    items: [...],\n  },\n};\n```\n\n## Advanced Migration Features\n\n### Role-Based Navigation\n\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'react-router',\n    items: [\n      {\n        id: 'admin-panel',\n        name: 'Admin Panel',\n        path: '/admin',\n        requiresRole: ['admin', 'superuser'],\n        section: 'main',\n      },\n      {\n        id: 'profile',\n        name: 'Profile', \n        path: '/profile',\n        section: 'footer',\n        // No role requirements - available to all\n      },\n    ],\n  },\n  user: {\n    currentRole: 'admin',\n  },\n};\n```\n\n### Navigation Callbacks\n\n```typescript\nconst config = {\n  navigation: {\n    strategy: 'react-router',\n    items: [...],\n    onBeforeNavigate: async (item) => {\n      // Check permissions, show loading, etc.\n      const hasPermission = await checkUserPermission(item.path);\n      return hasPermission;\n    },\n    onAfterNavigate: (item) => {\n      // Analytics, cleanup, etc.\n      analytics.track('sidebar_navigation', { path: item.path });\n    },\n  },\n};\n```\n\n### Custom Navigation Options\n\n```typescript\nconst { navigate } = useNavigation(config);\n\n// Navigate with query parameters\nnavigate(item, {\n  query: { tab: 'analytics', view: 'detailed' },\n  hash: 'section1',\n  replace: true,\n});\n```\n\n## Common Migration Patterns\n\n### Pattern 1: Minimal Changes\n\n1. **Import the new sidebar component**\n2. **Use auto-detection** (no configuration needed)\n3. **Gradually add customizations**\n\n```typescript\n// Step 1: Import new component\nimport Sidebar from './sidebars/ModelosaurusRefactored';\n\n// Step 2: Use with auto-detection\n<Sidebar>{children}</Sidebar>\n\n// Step 3: Add customizations later\nconst config = {\n  navigation: {\n    baseUrl: '/app',\n    // Add custom items as needed\n  },\n};\n<Sidebar config={config}>{children}</Sidebar>\n```\n\n### Pattern 2: Gradual Migration\n\n1. **Keep existing sidebar alongside new one**\n2. **Test new sidebar in development**\n3. **Switch production when ready**\n\n```typescript\n// Feature flag approach\nconst useNewSidebar = process.env.NODE_ENV === 'development' || \n                     process.env.REACT_APP_NEW_SIDEBAR === 'true';\n\nconst SidebarComponent = useNewSidebar \n  ? NewSidebar \n  : OldSidebar;\n\n<SidebarComponent>{children}</SidebarComponent>\n```\n\n### Pattern 3: Configuration Migration\n\n1. **Extract existing sidebar data**\n2. **Map to new format**\n3. **Apply configuration**\n\n```typescript\n// Helper function to migrate old format\nfunction migrateSidebarItems(oldItems: OldSidebarItem[]): SidebarNavigationItem[] {\n  return oldItems.map((item, index) => ({\n    id: item.id?.toString() || `item-${index}`,\n    name: item.text || item.name,\n    path: item.url || item.path,\n    icon: item.icon,\n    section: 'main' as const,\n    // Add any other transformations needed\n  }));\n}\n\nconst migratedItems = migrateSidebarItems(oldSidebarItems);\nconst config = {\n  navigation: {\n    strategy: 'react-router' as const,\n    items: migratedItems,\n  },\n};\n```\n\n## Troubleshooting Migration Issues\n\n### Issue: Navigation Not Working\n\n**Problem**: Clicking sidebar items doesn't navigate\n\n**Solutions**:\n1. Check routing strategy matches your app setup\n2. Verify React Router/Next.js is properly installed\n3. Enable auto-detection: `autoDetect: true`\n4. Add fallback strategy: `strategy: 'href'`\n\n```typescript\n// Debug configuration\nconst config = {\n  navigation: {\n    autoDetect: true,\n    strategy: 'href', // Fallback\n    items: [...],\n  },\n};\n```\n\n### Issue: Base URL Not Applied\n\n**Problem**: Routes not prefixed with base URL\n\n**Solutions**:\n1. Check environment variables\n2. Verify baseUrl in configuration\n3. Use auto-detection\n\n```typescript\n// Debug base URL\nconsole.log('Base URL:', process.env.REACT_APP_BASE_URL);\n\nconst config = {\n  navigation: {\n    baseUrl: process.env.REACT_APP_BASE_URL || '/fallback',\n    items: [...],\n  },\n};\n```\n\n### Issue: Icons Not Displaying\n\n**Problem**: Icons missing after migration\n\n**Solutions**:\n1. Update icon imports\n2. Wrap custom images in proper elements\n3. Check icon library configuration\n\n```typescript\n// For Heroicons\nimport { HomeIcon } from '@heroicons/react/24/outline';\n\n// For Lucide\nimport { Home } from 'lucide-react';\n\n// For custom images (Modelosaurus style)\nimport dashboard from './assets/dashboard.png';\nconst icon = <img src={dashboard} className=\"w-full h-full mask mask-circle\" alt=\"Dashboard\" />;\n```\n\n### Issue: TypeScript Errors\n\n**Problem**: Type errors during migration\n\n**Solutions**:\n1. Update imports to use new types\n2. Check configuration structure\n3. Use type assertions if needed\n\n```typescript\n// Import correct types\nimport { SidebarConfig, SidebarNavigationItem } from './types/sidebar-config';\nimport { NavigationStrategy } from './types/navigation';\n\n// Type assertion if needed (temporary)\nconst config = {\n  // ...\n} as SidebarConfig;\n```\n\n## Testing Migration\n\n### 1. Test All Navigation Strategies\n\n```typescript\n// Test each strategy\nconst strategies: NavigationStrategy[] = ['react-router', 'next', 'custom', 'href'];\n\nstrategies.forEach(strategy => {\n  const config = { navigation: { strategy, items: [...] } };\n  // Test navigation works\n});\n```\n\n### 2. Test Environment Detection\n\n```typescript\n// Test auto-detection\nimport { detectNavigationStrategy } from './hooks/useNavigation';\n\nconsole.log('Detected strategy:', detectNavigationStrategy());\n```\n\n### 3. Test Base URL Handling\n\n```typescript\n// Test URL construction\nimport { buildUrlPath } from './utils/routing';\n\nconsole.log(buildUrlPath('/dashboard', '/myapp')); // Should output: /myapp/dashboard\n```\n\n## Performance Considerations\n\n### 1. Lazy Loading\n\n```typescript\n// Lazy load sidebar components\nconst Sidebar = React.lazy(() => import('./components/Sidebar'));\n\n<Suspense fallback={<div>Loading...</div>}>\n  <Sidebar config={config}>{children}</Sidebar>\n</Suspense>\n```\n\n### 2. Memoization\n\n```typescript\n// Memoize configuration\nconst config = useMemo(() => ({\n  navigation: {\n    strategy: 'react-router',\n    items: navigationItems,\n  },\n}), [navigationItems]);\n\n<Sidebar config={config}>{children}</Sidebar>\n```\n\n### 3. State Persistence\n\n```typescript\n// Enable state persistence\nconst config = {\n  behavior: {\n    persistState: true, // Saves sidebar expansion state\n  },\n};\n```\n\n## Post-Migration Checklist\n\n- [ ] All navigation items work correctly\n- [ ] Active state detection functions properly\n- [ ] Base URLs are applied correctly in all environments\n- [ ] Mobile drawer functionality works\n- [ ] Role-based navigation filtering works (if used)\n- [ ] Tooltips display correctly when collapsed\n- [ ] TypeScript compilation succeeds without errors\n- [ ] All routing strategies tested\n- [ ] Performance is acceptable\n- [ ] Accessibility features work (keyboard navigation, ARIA labels)\n- [ ] Analytics/tracking still works (if implemented)\n- [ ] Tests pass\n\n## Getting Help\n\nIf you encounter issues during migration:\n\n1. **Check the comprehensive tests** in `__tests__/navigation.test.ts`\n2. **Review configuration examples** in `presets/sidebar-presets.ts`\n3. **Examine the routing utilities** in `utils/routing.ts`\n4. **Reference the type definitions** in `types/navigation.ts`\n5. **Look at the complete config documentation** in `README-CONFIG.md`\n\nThe migration system is designed to be backwards compatible and provides extensive fallbacks to ensure a smooth transition from the original sidebar implementations.\n\n---\n\n**Migration completed successfully!** 🎉\n\nYour sidebar now supports:\n- ✅ Universal routing across React Router, Next.js, and custom implementations\n- ✅ Environment-specific configurations\n- ✅ Base URL handling for subdirectories\n- ✅ TypeScript type safety\n- ✅ Comprehensive error handling and fallbacks\n- ✅ Role-based navigation\n- ✅ Advanced navigation features